<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Dependency injection - Catel documentation</title>
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../css/theme_colors.css" type="text/css" />
    <link rel="stylesheet" href="../../css/styles/vs.css">
    <link rel="stylesheet" href="../../css/font-awesome.4.5.0.min.css">
</head>
<body role="document">
    <div class="grid-for-nav">
        <nav data-toggle="nav-shift" class="nav-side stickynav">
            <div class="side-nav-search">
                <a href="../../index.htm"><i class="fa fa-home"></i> Catel documentation</a>
                <div role="search">
                    <form id="search-form" class="form" action="../../Docnet_search.htm" method="get">
                        <input type="text" name="q" placeholder="Search docs" />
                    </form>
                </div>
            </div>
            <div class="menu menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
<ul>
<li class="tocentry"><a href="../../Home.htm">Home</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Introduction.htm">Introduction</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../FAQ.htm">FAQ</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Setup,deployment&projects.htm">Setup, deployment & projects</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Gettingstarted.htm">Getting started</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Examples.htm">Examples</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../CatelCore.htm">Catel.Core</a></span></li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../ApiCop.htm">ApiCop</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../catel-core/argument-checking/index.htm">Argument checking</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../catel-core/caching/index.htm">Caching</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../catel-core/configuration/index.htm">Configuration</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Datahandling.htm">Data handling</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Exceptionhandling.htm">Exception handling</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../IoC(ServiceLocator&TypeFactory).htm">IoC (ServiceLocator & TypeFactory)</a></span></li>
<li class="tocentry"><a href="../../catel-core/ioc/introduction.htm">Introduction</a>
</li>
<li class="tocentry current"><a class="current" href="../../catel-core/ioc/dependency-injection.htm">Dependency injection</a>
<ul class="currentrelative">
<li class="tocentry"><a href="#introduction-to-dependency-injection">Introduction to dependency injection</a></li>
<li class="tocentry"><a href="#using-dependency-injection-in-catel">Using dependency injection in Catel</a></li>
<li class="tocentry"><a href="#disabling-dependency-injection">Disabling dependency injection</a></li>
</ul>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../IntroductiontoIoCcomponents.htm">Introduction to IoC components</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Automatictyperegistration.htm">Automatic type registration</a></span>
</li>
<li class="tocentry"><a href="../../catel-core/ioc/setting-up-using-configuration.htm">Setting up the ServiceLocator using configuration</a>
</li>
<li class="tocentry"><a href="../../catel-core/ioc/replacing-default-components.htm">Replacing the default components</a>
</li>

</ul>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Logging.htm">Logging</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Messaging.htm">Messaging</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Multilingual.htm">Multilingual</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Parallelinvocation&tasks.htm">Parallel invocation & tasks</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Pooling.htm">Pooling</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Preventingmemoryleaks.htm">Preventing memory leaks</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Reflection.htm">Reflection</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Scoping.htm">Scoping</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Serialization.htm">Serialization</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../Validation.htm">Validation</a></span>
</li>

</ul>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../CatelMVVM.htm">Catel.MVVM</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../tips-tricks/index.htm">Tips & tricks</a></span>
</li>

</ul>
				<div class="toc-footer">
					<span class="text-small">
						<hr/>
						<a href="https://github.com/FransBouma/DocNet" target="_blank">Made with <i class="fa fa-github"></i> DocNet</a>
					</span>
				</div>	
			</div>
            &nbsp;
        </nav>
        <section data-toggle="nav-shift" class="nav-content-wrap">
            <nav class="nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="nav-top" class="fa fa-bars"></i>
                <a href="../../index.htm">Catel documentation</a>
            </nav>
            <div class="nav-content">
                <div role="navigation" aria-label="breadcrumbs navigation">
                    <div class="breadcrumbs">
<ul><li><a href="../../Home.htm">Home</a></li> / <li><a href="../../CatelCore.htm">Catel.Core</a></li> / <li><a href="../../IoC(ServiceLocator&TypeFactory).htm">IoC (ServiceLocator & TypeFactory)</a></li> / <li><a href="../../catel-core/ioc/dependency-injection.htm">Dependency injection</a></li></ul>
					
                    </div>
                    <hr />
                </div>
                <div role="main">
                    <div class="section">
<h1 id="dependency-injection">Dependency injection<a class="headerlink" href="#dependency-injection" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h1>
<p>The ServiceLocator in Catel supports dependency injection.</p>
<h2 id="introduction-to-dependency-injection">Introduction to dependency injection<a class="headerlink" href="#introduction-to-dependency-injection" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Some people make dependency injection hard to understand, or maybe they don't understand it themselves. Dependency injection simply means that instead of hard referencing or instantiating other classes (dependendies), the dependencies are injected into the class via the constructor.</p>
<p><strong>Example 1: bad, instantiates the dependencies itself</strong></p>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
public class MyClass
{
    private IFirstDependency _firstDependency;
    private ISecondDependency _secondDependency;

    public MyClass()
    {
        _firstDependency = new FirstDependency();
        _secondDependency = new SecondDependency();
    }
}
</pre><p><strong>Example 2: good, retrieves the dependencies via the service locator</strong></p>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
public class MyClass
{
    private IFirstDependency _firstDependency;
    private ISecondDependency _secondDependency;

    public MyClass()
    {
        _firstDependency = ServiceLocator.Instance.ResolveType&lt;IFirstDependency&gt;();
        _secondDependency = ServiceLocator.Instance.ResolveType&lt;ISecondDependency&gt;();
    }
}
</pre><p> </p>
<p><strong>Example 3: good, gets the dependencies injected</strong></p>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
public class MyClass
{
    private IFirstDependency _firstDependency;
    private ISecondDependency _secondDependency;

    public MyClass(IFirstDependency firstDependency, ISecondDependency secondDepdenceny)
    {
        Argument.IsNotNull(&quot;firstDependency&quot;, firstDependency);
        Argument.IsNotNull(&quot;secondDependency&quot;, secondDependency);

        _firstDependency = firstDependency;
        _secondDependency = secondDependency;
    }
}
</pre><p>There are other ways of using dependency injection, for example via attributes. This documentation will focus on dependency injection via the constructor only</p>
<h2 id="using-dependency-injection-in-catel">Using dependency injection in Catel<a class="headerlink" href="#using-dependency-injection-in-catel" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<h3 id="constructor-injection">Constructor injection<a class="headerlink" href="#constructor-injection" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>Dependency injection via the ServiceLocator in Catel is enabled by default. This means that when a type is resolved from the container, it will automatically use dependency injection to construct the type if it is not registered as instance.</p>
<p>It will first search for all available constructors on the type that will be instantiated. Then, for each constructor, starting with the one with the most parameters, it will try to retrieve all values. If one fails, it will go to the next. If all fail, it will try to use the default constructor without parameters. If that fails as well, then the type cannot be constructed and an exception will be thrown.</p>
<p> To get a better understanding of what happens, see the class below:</p>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
public class MyClass
{
    private IFirstDependency _firstDependency;
    private ISecondDependency _secondDependency;

    public MyClass()
        : this(null) { }

    public MyClass(IFirstDependency firstDependency)
        : this(firstDependency, null) { }

    public MyClass(IFirstDependency firstDependency, ISecondDependency secondDependency)
    {
        _firstDependency = firstDependency;
        _secondDependency = secondDependency;
    }
}
</pre><p>When the MyClass will be retrieved from the ServiceLocator, this will happen:</p>
<ol>
<li>Find constructor with most parameters (the one with both firstDependency and secondDependency). If both IFirstDependency and ISecondDependency can be resolved from the ServiceLocator, the type will be constructed with the constructor. Otherwise it will proceed with step 2.</li>
<li>Find next constructor with most parameters (the one with only firstDependency). If IFirstDependency can be resolved from the ServiceLocator, the type will be constructed with the constructor. Otherwise it will proceed with step 3.</li>
<li>At this point, no constructor could be used. In this case, the ServiceLocator will try to use the default constructor (the one without parameters) as last resort to instantiate the type.</li>
</ol>
<h4 id="manually-defining-the-constructor-to-use-for-dependency-injection">Manually defining the constructor to use for dependency injection<a class="headerlink" href="#manually-defining-the-constructor-to-use-for-dependency-injection" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h4>
<p>Catel first sorts the constructors based on the number of parameters. Then it will &quot;sub-sort&quot; the same number of parameters and puts parameters with <em>Object</em> and <em>DynamicObject</em> as last so it will first try all constructors with the best possible matches</p>
<p>If Catel is still unable to pick the right constructor in a class, this behavior can be overridden by decorating the constructor with the DependencyInjectionConstructor attribute:</p>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
public MyClass(IPerson person)
{
 
}
 
[InjectionConstructor]
public MyClass(Person person)
{
    // Catel will now first try to use this constructor, no matter the order or number of parameters
}
</pre><h4 id="advanced-dependency-injection">Advanced dependency injection<a class="headerlink" href="#advanced-dependency-injection" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h4>
<p>Starting with Catel 3.7, a new type of dependency injection is supported. It allows a developer to instantiate types that combine custom constructor injection with dependency injection. The class belows shows an interesting combination of custom values that need to be injected and dependencies that can be retrieved from the IoC container. Before Catel 3.7, one had to manually retrieve the dependencies from the IoC container when it also required other dependencies to be injected that were not registered in the IoC container:</p>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
public class PersonViewModel : ViewModelBase
{
    private readonly IMessageService _messageService;
    private readonly IProcessService _processService;
 
    public PersonViewModel(IPerson person)
    {
        Argument.IsNotNull(() =&gt; person);
        
        Person = person;
        
        _messageService = ServiceLocator.Default.ResolveType&lt;IMessageService&gt;();
        _processService = ServiceLocator.Default.ResolveType&lt;IProcessService&gt;();
    }
    
    ...
}
</pre><p>With the new technology, such a constructor can be rewritten to truly support dependency injection:</p>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
public class PersonViewModel : ViewModelBase
{
    private readonly IMessageService _messageService;
    private readonly IProcessService _processService;
 
    public PersonViewModel(IPerson person, IMessageService messageService, IProcessService processService)
    {
        Argument.IsNotNull(() =&gt; person);
        Argument.IsNotNull(() =&gt; messageService);
        Argument.IsNotNull(() =&gt; processService);
        
        Person = person;
        
        _messageService = messageService;
        _processService = processService
    }
    
    ...
}
</pre><p> </p>
<p>This feature is initially written to support dependency injection in combination with <a href="Introduction_to_the_nested_user_controls_problem">nested user controls</a></p>
<p>The advanced dependency injection can be used by using the TypeFactory class. Below is an example on how to create a new type using advanced dependency injection:</p>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
var personViewModel = TypeFactory.Default.CreateInstanceWithParametersAndAutoCompletion&lt;PersonViewModel&gt;(new Person());
</pre><p>As you can see it is only required to pass in the objects that are not registered in the IoC container. All other dependencies will be automatically resolved from the <em>ServiceLocator</em>.</p>
<p>Note that the order of the parameters must be the same as the constructor, otherwise the <em>TypeFactory</em> cannot determine the right constructor to use</p>
<h3 id="property-injection">Property injection<a class="headerlink" href="#property-injection" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>Starting with Catel 3.8, it is also possible to use property injection. The difference with constructor injection is that the TypeFactory will automatically set up all properties that required dependency injection.</p>
<p>Note that the Catel team recommends using constructor injection over property injection. Property injection looks like a silver bullet, but is very tricky because:</p>
<p>1) It does not allow you to check for <em>null</em> values and store dependencies in private fields (when)?</p>
<p>2) Dependency Injection is just a technique. When using a constructor, you can force a user to provide the value and check the input. With property injection, you can only <em>hope</em> that the user will set them for you, there is no way to check this (unless that is some <em>after constructor and dependency injection</em> initialization routine. This is never the case if a user manually creates a type though.</p>
<p>To use property injection, simply decorate the properties of a class with the Inject attribute. Below are several options:</p>
<h4 id="type-is-automatically-determined-based-on-property-type">Type is automatically determined based on property type<a class="headerlink" href="#type-is-automatically-determined-based-on-property-type" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h4>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
public class MyClass
{
    [Inject]
    public IMyDependency MyDependency { get; set; }
}
</pre><h4 id="type-is-manually-defined">Type is manually defined<a class="headerlink" href="#type-is-manually-defined" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h4>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
public class MyClass
{
    [Inject(typeof(IMySubclassedDependency))]
    public IMyDependency MyDependency { get; set; }
}
</pre><h4 id="using-tags">Using tags<a class="headerlink" href="#using-tags" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h4>
<p>It is also possible to determine the tag of a registered dependency:</p>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
public class MyClass
{
    [Inject(Tag = &quot;myTag&quot;)]
    public IMyDependency MyDependency { get; set; }
}
</pre><h2 id="disabling-dependency-injection">Disabling dependency injection<a class="headerlink" href="#disabling-dependency-injection" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p> Maybe you don't want dependency injection because it does not give you what you need or you want a very, very small improvement in performance. In that case, the dependency injection can be disabled using the code below:</p>
<pre class="nocode">{.java data-syntaxhighlighter-params=&quot;brush: java; gutter: false; theme: Confluence&quot; data-theme=&quot;Confluence&quot; style=&quot;brush: java; gutter: false; theme: Confluence&quot;}
ServiceLocator.Default.SupportedDependencyInjection = false
</pre>
                    </div>
                </div>
                <footer>
                    <hr />
                    <div role="contentinfo">

                    </div>
                </footer>
            </div>
        </section>
    </div>
    <script src="../../js/jquery-2.1.1.min.js"></script>
    <script src="../../js/modernizr-2.8.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script src="../../js/theme.js"></script>

</body>
</html>
