<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Introduction - Catel documentation</title>
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../css/theme_colors.css" type="text/css" />
    <link rel="stylesheet" href="../../../css/styles/vs.css">
    <link rel="stylesheet" href="../../../css/font-awesome.4.5.0.min.css">
</head>
<body role="document">
    <div class="grid-for-nav">
        <nav data-toggle="nav-shift" class="nav-side stickynav">
            <div class="side-nav-search">
                <a href="/welcome/index.htm"><i class="fa fa-home"></i> Catel documentation</a>
                <div role="search">
                    <form id="search-form" class="form" action="../../../Docnet_search.htm" method="get">
                        <input type="text" name="q" placeholder="Search docs" />
                    </form>
                </div>
            </div>
            <div class="menu menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
<ul>
<li class="tocentry"><a href="../../../home.htm">Home</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../introduction/">Introduction</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../faq/">FAQ</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../setup-deployment/">Setup, deployment & projects</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../getting-started/">Getting started</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../examples/">Examples</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../catel-core/">Catel.Core</a></span></li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/apicop/">ApiCop</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/argument-checking/">Argument checking</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/caching/">Caching</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/configuration/">Configuration</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/data-handling/">Data handling</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/exception-handling/">Exception handling</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/ioc/">IoC (ServiceLocator & TypeFactory)</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/logging/">Logging</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/messaging/">Messaging</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/multilingual/">Multilingual</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/parallel-invocation-tasks/">Parallel invocation & tasks</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../catel-core/pooling/">Pooling</a></span></li>
<li class="tocentry current"><a class="current" href="../../../catel-core/pooling/introduction/">Introduction</a>
<ul class="currentrelative">
<li class="tocentry"><a href="#introduction-to-the-pool-manager">Introduction to the pool manager</a></li>
<li class="tocentry">
<ul class="currentrelative">
<li class="tocentry"><a href="#retrieving-objects-from-the-pool">Retrieving objects from the pool</a></li>

<li class="tocentry"><a href="#returning-objects-to-the-pool">Returning objects to the pool</a></li>


</ul>
</li>

<li class="tocentry"><a href="#customizinga-pool-manager">Customizing a pool manager</a></li>
<li class="tocentry">
<ul class="currentrelative">
<li class="tocentry"><a href="#customizing-the-maximum-size">Customizing the maximum size</a></li>


</ul>
</li>

<li class="tocentry"><a href="#creating-a-poolable-object">Creating a poolable object</a></li>



</ul>

</ul>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/preventing-memory-leaks/">Preventing memory leaks</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/reflection/">Reflection</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/scoping/">Scoping</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/serialization/">Serialization</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/validation/">Validation</a></span>
</li>

</ul>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/">Catel.MVVM</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-fody/">Catel.Fody</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-resharper/">Catel.ReSharper</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../tips-tricks/">Tips & tricks</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../reference/">API reference</a></span>
</li>

</ul>
				<div class="toc-footer">
					<span class="text-small">
						<hr/>
						<a href="https://github.com/FransBouma/DocNet" target="_blank">Made with <i class="fa fa-github"></i> DocNet</a>
					</span>
				</div>	
			</div>
            &nbsp;
        </nav>
        <section data-toggle="nav-shift" class="nav-content-wrap">
            <nav class="nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="nav-top" class="fa fa-bars"></i>
                <a href="../../../index.htm">Catel documentation</a>
            </nav>
            <div class="nav-content">
                <div role="navigation" aria-label="breadcrumbs navigation">
                    <div class="breadcrumbs">
<ul><li><a href="../../../home.htm">Home</a></li> / <li><a href="../../../catel-core/index.htm">Catel.Core</a></li> / <li><a href="../../../catel-core/pooling/index.htm">Pooling</a></li> / <li><a href="../../../catel-core/pooling/introduction/index.htm">Introduction</a></li></ul>

                    </div>
                    <hr />
                </div>
                <div role="main">
                    <div class="section">
<h1 id="pooling">Pooling<a class="headerlink" href="#pooling" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h1>
<p>Garbage collection in .NET can be very expensive, especially for objects on the Large Object Heap (LOH). .NET itself already uses pooling for threads to prevent the costly creation of threads but instead re-uses the already created threads using a thread pool. Catel provides an implementation of pooling using the <em>PoolManager&lt;TPoolable&gt;</em>. This allows both Catel and third party developers to create a pool for large objects so they can be reused.</p>
<div class="alert alert-info"><span class="alert-title"><i class="fa fa-info-circle"></i> Info</span><p>The documentation uses a byte array of 4096 as poolable object as example. If <em>_poolManager</em> is used in the code below, it represents an instance of <em>PoolManager&lt;Buffer4096Poolable&gt;</em></p>
</div><h2 id="introduction-to-the-pool-manager">Introduction to the pool manager<a class="headerlink" href="#introduction-to-the-pool-manager" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>The pool manager internally uses a stack to manage the available objects in the pool. It's important to understand how a pool works. The flow diagram below shows how the pool manager deals with objects:</p>
<p><img src="../../../images/catel-core/pooling/hasobjects.png" width="676" height="255" /></p>
<p>It is recommended that a pool manager gets registered in the <em>ServiceLocator</em> so it can be re-used by multiple components.</p>
<div class="alert alert-warning"><span class="alert-title"><i class="fa fa-warning"></i> Important!</span><p>Note that the pool manager does not limit the number of objects in memory. It has a <em>MaxSize</em> property so it will store only a maximum amount of objects inside the internal pool, but if the pool is running out of instances and a new object is requested, it will return a new instance (and thus creating a new object which could be garbage collected).</p>
</div><h3 id="retrieving-objects-from-the-pool">Retrieving objects from the pool<a class="headerlink" href="#retrieving-objects-from-the-pool" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>Retrieving an object from the pool is very simple. When an instance of the <em>PoolManager&lt;TPoolable&gt;</em> is available, use the code below:</p>
<pre class="nocode">var poolableBuffer = _poolManager.GetObject();
</pre><p>The <em>PoolManager&lt;TPoolable&gt;</em> will automatically create a new object when no objects are available in the pool.</p>
<h3 id="returning-objects-to-the-pool">Returning objects to the pool<a class="headerlink" href="#returning-objects-to-the-pool" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>Objects should be automatically returned to the pool when the objects are disposed. This means the objects are not really disposed but the state is being reset and the object is being returned to the pool. To automatically take care of this, it's best to use the <em>PoolManager&lt;TPoolable&gt;</em> as shown below:</p>
<pre class="nocode">using (var poolableBuffer = _poolManager.GetObject())
{
    var buffer = poolableBuffer.Data;

    // work with the buffer here
}

// outside the scope, the object is automatically disposed and returned to the pool
</pre><p>The flow chart below shows how the <em>PoolManager&lt;TPoolable&gt;</em> will handle the dispose:</p>
<p><img src="../../../images/catel-core/pooling/reachedmaxsize.png" width="676" height="255" /></p>
<h2 id="customizinga-pool-manager">Customizing a pool manager<a class="headerlink" href="#customizinga-pool-manager" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Catel implements pooling via the <em>PoolManager&lt;TPoolable&gt;</em> class. This class allows the caller to retrieve an object. There is no need to explicitly derive a class from the PoolManager&lt;TPoolable&gt;. It can be customized though.</p>
<h3 id="customizing-the-maximum-size">Customizing the maximum size<a class="headerlink" href="#customizing-the-maximum-size" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h3>
<p>By default, the <em>PoolManager&lt;TPoolable&gt;</em> uses a maximum size of 5 MB per poolable type. If, for this example, the maximum size of byte buffers should be 1 MB, use the code below:</p>
<pre class="nocode">var poolManager = new PoolManager&lt;Buffer4096Poolable&gt;();
poolManager.MaxSize = 1024 * 1024 * 1;
</pre><p>If the <em>MaxSize</em> is reached, objects will not be added back to the internal pool but be left out and, if no other references exist to this object, be ready for garbage collection.</p>
<h2 id="creating-a-poolable-object">Creating a poolable object<a class="headerlink" href="#creating-a-poolable-object" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Since the objects need to be re-used, it's very important that the <em>PoolManager&lt;TPoolable&gt;</em> knows how to reset objects to the initial state. Therefore every poolable object needs to implement <em>IPoolable</em> which also implements <em>IDisposable</em>. Below is an example implementation of a poolable object.</p>
<pre class="nocode">public class Buffer4096Poolable : IPoolable
{
    private const int BufferSize = 4096;
    protected IPoolManager _poolManager;

    public Buffer4096Poolable()
    {
        Data = new byte[BufferSize];
    }

    public byte[] Data { get; private set; }

    public int Size { get { return BufferSize; } }

    public void Reset()
    {
        var buffer = Data;
        Array.Clear(buffer, 0, buffer.Length);        
    }

    // Implemented explicitly so it can't be called accidentally
    void IPoolable.SetPoolManager(IPoolManager poolManager)
    {
        _poolManager = poolManager;
    }

    public void Dispose()
    {
        _poolManager.ReturnObject(this);
    }
}
</pre>
                    </div>
                </div>
                <footer>
                    <hr />
                    <div role="contentinfo">

                      <p>
					    Is this section not up-to-date or found an issue? Please <a href="https://github.com/Catel/Catel.Docs/blob/master/src/../src/vnext/catel-core/pooling/introduction.md" target="_blank">contribute</a>!
					  </p>
					  <p>
					    Have a question about Catel? Use <a href="https://stackoverflow.com/questions/tagged/catel" target="_blank">StackOverflow</a> with the <i>Catel</i> tag!
					  </p>
					  <hr />
					  <p>
					    <h2>Discussion</h2>
					   <div id="disqus_thread"></div>
					   <script>
					   var disqus_config = function () {
					   this.page.url = 'http://docs.catelproject.com/catel-core/pooling/introduction/index.htm';
					   this.page.identifier = '../src/vnext/catel-core/pooling/introduction.md';
					   };
					   (function() { // DON'T EDIT BELOW THIS LINE
					   var d = document, s = d.createElement('script');
					   s.src = 'https://catel-docs.disqus.com/embed.js';
					   s.setAttribute('data-timestamp', +new Date());
					   (d.head || d.body).appendChild(s);
					   })();
					   </script>
					   <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
					  </p>
					</div>
                </footer>
            </div>
        </section>
    </div>
    <script src="../../../js/jquery-2.1.1.min.js"></script>
    <script src="../../../js/modernizr-2.8.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script src="../../../js/theme.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-25600919-4', 'auto');
      ga('send', 'pageview');
    
    </script>
</body>
</html>
